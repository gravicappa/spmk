#!/usr/bin/env rc

cmddir=$HOME/dev/spkg
spkg_header=$HOME/dev/spkg/spkg_header.rc
spkg_mk=$HOME/dev/spkg/spkg.mk
spkg_privkey=$HOME/dev/spkg/priv.key
root=$HOME/dev/spkg/root
pkgdb=$root/var/lib/spkg
ports=$root/usr/ports
buildroot=$root/tmp/build

cmd=$1
if (~ $cmd -*)
	shift
switch ($cmd) {
	case ''
		test -f build.mk || { echo 'no build.mk' >[1=2]; exit 1 }
		dir=`{pwd}
		cd $pkgdb
    exec mk -f <{$cmddir/mkports $"dir/build.mk $ports/*/build.mk}

  case -b
    cd $pkgdb
    exec mk -f <{$cmddir/mkports $ports/*/build.mk} $*

  case -a
    echo 'TODO: binary package install' >[1=2]
    exit 1

  case -r
    exec mk -f <{$cmddir/mkrevdep spkg_rm} $*

  case -d
    exec mk -f <{$cmddir/mkdep $ports/*/build.mk} $*

  case -rd
    exec mk -f <{$cmddir/mkrevdep echo} $*

	case -u
		echo 'TODO: update system' >[1=2]
		exit 1

  case *
		for (f in $*) {
			if (~ $f *.tar.gz && test -f $f) {
				echo 'TODO: install binary package' $f >[1=2]
				echo '#' spkg_add $f
			}
			if not {
				echo 'Usage: spkg [-b|-a|-r|-d|-rd|-u] packages...'
				exit 1
			}
		}
}
