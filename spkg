#!/usr/bin/env rc

spkgdir=$HOME/dev/spkg
pkg_header=$spkgdir/mkpkg
testdir=$HOME/dev/spkg/root
ports=$testdir/ports
buildroot=$testdir/build
root=$testdir/root
dbroot=$testdir/packages

cmd=$1
if (~ $cmd -*)
	shift
switch ($cmd) {
	case ''
		test -f build.mk || { echo 'no build.mk' >[1=2]; exit 1 }
		dir=`{pwd}
		cd $dbroot
    exec mk -f <{$spkgdir/mkports.awk $"dir/build.mk $ports/*/build.mk}

  case -b
    cd $dbroot
    exec mk -f <{$spkgdir/mkports.awk $ports/*/build.mk} $*

  case -a
    echo 'TODO: binary package install' >[1=2]
    exit 1

  case -r
    exec mk -f <{$spkgdir/mkrevdep $spkgdir/spkg_rm} $*

  case -d
    exec mk -f <{$spkgdir/mkdep.awk $ports/*/build.mk} $*

  case -rd
    exec mk -f <{$spkgdir/mkrevdep echo} $*

	case -u
		echo 'TODO: update system' >[1=2]
		exit 1

  case *
		for (f in $*) {
			if (~ $f *.tar.gz && test -f $f) {
				echo 'TODO: install binary package' $f >[1=2]
				echo '#' $spkgdir/spkg_add $f
			}
			if not {
				echo 'Usage: spkg [-b|-a|-r|-d|-rd|-u] packages...'
				exit 1
			}
		}
}
