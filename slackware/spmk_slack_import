#!/usr/bin/env rc

arch_list=(noarch i686 i486 i386 i586)
cachefile=$ports/slackware/slackware/build.mk

if (! test -e $cachefile -a $cachefile -nt /var/log/packages) {
  {
    for (a in $arch_list)
      echo %-$a: %
    echo
    for (file in /var/log/packages/*)
      awk -v 'file='$file -v 'pkgname='`{basename $file} 'BEGIN {
        name = tolower(pkgname)
        sub(/-[0-9].*$/, "", name)
        tail = tolower(pkgname)
        sub("^" name "-", "", tail)
        n = split(tail, x, "-")
        ver = x[1]
        pkgver = x[n]
        printf "%s:V: %s\n", name, pkgname
        printf "%s-%s-%s:V: %s\n\n", name, ver, pkgver, pkgname
      }'
  } >$cachefile
}
