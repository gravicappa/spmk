#!/usr/bin/env rc

sudo=sudo
pkgdb=
ports=

force=()
if (~ $1 '-f')
  force=yes

if (test -z $"force -a -e $pkgdb -a $pkgdb -nt /var/log/packages)
  exit 0

if (! ~ `{id -u} 0)
  exec $sudo 'pkgdb='$pkgdb 'ports='$ports $0 $*

mkdir -p $pkgdb
rm -f $pkgdb/*
{
  echo '%:Q:'
  echo '  _found=0'
  echo '  for (_x in $target-[0-9]*)'
  echo '    if (test -e $_x)'
  echo '      _found=1'
  echo '  if (~ $_found 0)'
  echo '    $sudo slapt-get -i $target || $sudo slackpkg install $target'
  echo '  if not true'
  echo ''
  #for (file in /var/log/packages/*) {
  #  name=`{spmk_name $file}
  #  basename $file >$pkgdb/$"name
  #  s=`{echo $"name | sed 's/-[0-9].*$//'}
  #  echo $s:QV:$"name
  #}
} >$ports/slackware/slackware/build.mk
