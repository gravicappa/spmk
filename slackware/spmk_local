#!/usr/bin/env rc

sudo=sudo
pkgdb=
ports=

force=()
if (~ $1 '-f')
  force=yes

if (test -z $"force -a -e $pkgdb -a $pkgdb -nt /var/log/packages)
  exit 0

if (! ~ `{id -u} 0)
  exec $sudo 'pkgdb='$pkgdb 'ports='$ports $0 $*

mkdir -p $pkgdb
rm -f $pkgdb/*
{
  echo '%:Q:'
  echo '  $sudo slapt-get -i $target || $sudo slackpkg install $target'
  echo ''
  for (file in /var/log/packages/*) {
    name=`{spmk_name $file}
    basename $file >$pkgdb/$"name
    s=`{echo $"name | sed 's/-[0-9].*$//'}
    echo $s:QV:$"name
  }
} >$ports/slackware/slackware/build.mk
