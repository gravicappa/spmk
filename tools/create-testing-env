#!/usr/bin/env rc

pwd=`{pwd}
testdir=$pwd/root
nports=40

rm -rf $testdir

# where database of packages is stored  
mkdir -p $testdir/var/lib/spmk

# where fake port tree is generated
mkdir -p $testdir/usr/ports

mk 'root='$testdir 'prefix='$testdir/usr \
   'etcdir='$testdir/etc || exit 1

echo 'DONE' >[1=2]

./tools/generate-fake-ports $testdir/usr/ports $nports

cp ./tools/pub.key $testdir/etc/spmk/pubkeys/
cp ./tools/priv.key $testdir/etc/spmk/

echo 'usr/bin/pcc' >> $testdir/etc/spmk/exclude
echo 'usr/share/dev/file' >> $testdir/etc/spmk/save

{
	echo '#!/bin/sh'
	echo 'export PATH='$testdir/usr/sbin:'$PATH'
	echo 'exec "$@"'
} > $testdir/s
chmod +x $testdir/s
