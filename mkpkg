#!/bin/sh

test -e "$target" && exit 0

name=`echo $target | sed 's/-[0-9].*$//'`
version=`echo $target | sed "s/$name-//"`
pkgdir=$ports/$name/pkg

msg() {
	echo = $target: "$@"
}

remove_old() {
  msg 'TODO: remove old version?' $@;
}

sortver() {
  sort -t. -k1,1n -k2,2n -k3,3n -k4,4n -k5,5n
}

listversions() {
  for p in "$name-"*; do
    echo $p
  done
}

die() {
  echo '!' $target: error: "$@" >&2
  exit 1
}

verifypkg() {
	msg checking
	if test -f "$ports/$name/sig" ; then
		while read line ; do
			sum=`echo "$line" | cut -d' ' -f1`
			file=`echo "$line" | cut -d' ' -f2-`
			realsum=`sha1sum "$ports/$name/$file" | cut -d' ' -f1`
			if test _"$sum" != _"$realsum" ; then
				die "$file" wrong checksum
			fi
		done < "$ports/$name/sig"
	else
		msg warning: no signature
	fi
}

installpkg() {
	msg installing pkg
  type make_package >/dev/null 2>&1 && make_package
	mkdir -p $target
	for p in $prereq; do
		echo $p
	done > $target/deps
}

for h in $mkpkg_headers; do
  $h
done

versions=`listversions | sortver`

for p in $versions ; do
  remove_old $p
done
